{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "name": {
      "type":"string", 
      "metadata": {
        "description": "URL prefix, can be org name, use small latin letters and digits."
      }
    },
    "docker": {
      "type": "secureObject", 
      "defaultValue": {
        "login": "", 
        "pass": "",
        "url": ""
      }
    },
    "release": {
      "type": "string",
      "defaultValue": "v.1:release"
    },
    "custom": {
      "type": "object",
      "defaultValue": {},
      "metadata": {
        "description": "You can leave it blank"
      }      
    }
  },
  "variables": {
    "adminkey": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7LfbMepWP5FNbATMmub6iV3rPPxVNB7IuJivBCQPIFcA5PGwv76ffi9UXTZgx9m2mzfCw1/yl5pZ82Anvsy6rJjduFevDXcb5EGIQQAFe+ipIzaIKBnUJL86Sb6ftym+VdNz7n/tuxidI4ou691uAl6PcIOekEn/KxlvpaXfB/OJKTP0sYxLK0Fe0s2EPn1nGXFe6WFcfOhDXWVKvRqFD+f6tFaOaWAgJm/ie31ODpbVl8a42gR9sv5ICWUQ2ry7VS/LxC1jiz6sM5IwqRL4ORbsrvFPXD/VlbcgyHIgpDZRQ4RGcle1Lj4WMc+/LQOgk7R+aR3iIr9SEgNwm3wkl YVAStaff",
    "slack": "https://hooks.slack.com/services/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",
    "host_kv": {
      "inf": {
        "front": {
          "kv": {
            "PLATFORM_INF_HOST_ROLE": "front"
          }
        }
      }
    },
    "size2use": "inf"
  }, 
  "resources": [
    {
      "name": "master",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2015-01-01",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[uri(deployment().properties.templateLink.uri, 'master.json')]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "master": {
            "value": {
              "prefix": "inf", 
              "admin": "deploy",
              "adminkey": "[variables('adminkey')]",
              "slack": "[variables('slack')]",
              "name": "[parameters('name')]", 
              "dlogin": "[parameters('docker').login]", 
              "dpass": "[parameters('docker').pass]", 
              "dserver": "[parameters('docker').url]", 
              "applications": "inf", 
              "initurl": "https://releases.yva.ai/inf/r0/version.json"
            }
          }, 
          "appkv": {
            "value": {
              "INF_MAIL": "account@yva.ai",
              "INF_URL_0": "${INIT_AZURE_URL}"
            }
          },
          "appkv_secure": {
            "value": {
              "INF_SALT": "[uniqueString(concat(subscription().id))]"              
            }
          }, 
          "hostkv": {
            "value": "[variables('host_kv')[variables('size2use')]]"
          }, 
          "size": {
            "value": "[variables('size2use')]"
          },
          "custom": {
            "value": "[parameters('custom')]"
          }
        }
      }
    }
  ],
  "outputs": {
    "uri": {
      "type": "string",
      "value": "[reference('master').outputs.uri.value]"
    },
    "ip": {
      "type": "string",
      "value": "[reference('master').outputs.ip.value]"
    }
  }
}